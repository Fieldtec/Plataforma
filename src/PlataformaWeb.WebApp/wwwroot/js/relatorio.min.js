(function(){this.apiRelatorio=this.apiRelatorio||{};var n=this.apiRelatorio;n.nomeRelatorio=null;n.callback=null;n.init=function(){var i=$("#relatorioModal"),r=$("#btnImprimirRelatorio"),t=$("#formFiltrosRelatorio"),u=$("#tituloRelatorioModal");$(document).on("click",".link-relatorio",function(n){n.preventDefault();var r=$(this).data("relatorio"),f=$(this).data("titulo");if(!r||!f){MostraAlerta("Configuração inválida para o relatório","Atenção",TipoAlerta.Warning,$(this),!1,!1);return}apiRelatorio.nomeRelatorio=r;u.html(f);apiRelatorio.callback=null;t.find(".modal-body").LoadPartialView(r,"Relatorios",function(){i.modal("show")})});r.on("click",function(){var i=t.ValidForm(),n;i&&(n=t.GetJsonData(),apiRelatorio.callback&&(n=apiRelatorio.callback(n)),apiRelatorio.imprimir(n))});i.on("shown.bs.modal",function(){t.find(".modal-body").find("input, select, textarea").eq(0).focus()});i.on("hide.bs.modal",function(){t.find(".modal-body").html("");apiRelatorio.callback=null;n.nomeRelatorio=null})};n.imprimir=function(t,i){var r={nomeRelatorio:i||n.nomeRelatorio,filtro:obterFiltosFormatadosRelatorio(t)};$.postUrlAjax(r,"imprimir-relatorio",!0,function(n){window.open(raizAplicacao+"reports/"+n,"_blank");MostraAlerta("Relatório emitido com sucesso","Sucesso",TipoAlerta.Sucesso,$(this),!1,!0)})}})();$(document).ready(function(){apiRelatorio.init()});